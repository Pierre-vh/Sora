// RUN: %sorac-typecheck -verify -dump-ast %s | %filecheck %s

func foo() {
    // CHECK: DeclRefExpr type={{.*}} loc=line:5:15 decl='foo'@line:3:6
    let foo = foo 
    // CHECK: DeclRefExpr type={{.*}} loc=line:7:5 decl='foo'@line:5:9
    foo
    {
        // CHECK: DeclRefExpr type={{.*}} loc=line:10:19 decl='foo'@line:5:9
        let foo = foo 
        // CHECK: DeclRefExpr type={{.*}} loc=line:12:9 decl='foo'@line:10:13
        foo
        {
            // CHECK: DeclRefExpr type={{.*}} loc=line:15:23 decl='foo'@line:10:13
            let foo = foo
            // CHECK: DeclRefExpr type={{.*}} loc=line:17:13 decl='foo'@line:15:17
            foo
        }
    }
}

func lvalues(a: i32) {
  let (mut b: u16, c: i16)
  // CHECK: DeclRefExpr type=i32 loc=line:25:3 decl='a'@line:22:14
  a
  // CHECK: DeclRefExpr type=@lvalue u16 loc=line:27:3 decl='b'@line:23:12
  b
  // CHECK: DeclRefExpr type=i16 loc=line:29:3 decl='c'@line:23:20
  c
}

func bar(bar: i32) {
    // CHECK: DeclRefExpr type=i32 loc=line:34:5 decl='bar'@line:32:10
    bar
    bux // expect-error: cannot find value 'bux' in this scope
}

func nested(foo: i32, bar: i32) {
  func nested2(foo: i32) {
    let localvar: i32
    foo
    bar // expect-error: cannot capture dynamic environment inside a local function
    func nested3() {
      nested
      nested2
      nested3
      localvar  // expect-error: cannot capture dynamic environment inside a local function
      foo       // expect-error: cannot capture dynamic environment inside a local function
      bar       // expect-error: cannot capture dynamic environment inside a local function
    }
  }
  localvar  // expect-error: cannot find value 'localvar' in this scope
  nested3   // expect-error: cannot find value 'nested3' in this scope
  foo
  bar
  nested
  nested2
}