// RUN: %sorac-typecheck -dump-ast -verify %s | %filecheck %s

func test() {
    let x: maybe i32 = 0
    if let x = x {
      // CHECK: DeclRefExpr type=i32 loc=line:7:7 decl='x'@line:5:12
      x // has type i32
    }
    // CHECK: IntegerLiteralExpr type=i32 loc=line:10:16
    if let x = 0 { // expect-error: initializer for conditional binding must have a maybe type, not 'i32'
      // CHECK: DeclRefExpr type=i32 loc=line:12:7 decl='x'@line:10:12
      x
    }
    // CHECK: IntegerLiteralExpr type=i64 loc=line:15:21
    if let x: i64 = 0 { // expect-error: initializer for conditional binding must have a maybe type, not 'i64'
      // CHECK: DeclRefExpr type=i64 loc=line:17:7 decl='x'@line:15:12
      x
    }
    let y: maybe maybe void = ()
    if let y = y {
      if let y = y {
        // CHECK: DeclRefExpr type=void loc=line:23:9 decl='y'@line:21:14
        y
      }
    }
    let z: maybe i32 = 0
    if let (x, y) = (z, z) { // expect-error: initializer for conditional binding must have a maybe type, not '(maybe i32, maybe i32)'
    
    }

   if let x = null {}    // expect-error: initializer for conditional binding must have a maybe type, not 'null'
                         // expect-error@-1: type of 'x' is ambiguous without more context
                         // expect-note@-2:  add a type annotation to give 'x' a type
   while let x = null {} // expect-error: initializer for conditional binding must have a maybe type, not 'null'
                         // expect-error@-1: type of 'x' is ambiguous without more context
                         // expect-note@-2:  add a type annotation to give 'x' a type

   if let x {}           // expect-error: variable binding in a condition requires an initializer
   while let x {}        // expect-error: variable binding in a condition requires an initializer
}
